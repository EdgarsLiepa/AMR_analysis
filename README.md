# AMR Analysis Pipeline

A Nextflow-based bioinformatics workflow for processing shotgun metagenomic paired-end reads, removing host contamination, and quantifying Antimicrobial Resistance (AMR) genes.

Additional note. 
This is not a complete and tested pipeline and probably needs additional configuration to work properly.
But this repository demonstrates AMR reconstruction logic and tools used for a project.


## Overview

The pipeline executes the following steps:

1. **Raw Read QC**: Generates quality metrics using FastQC and aggregates them with MultiQC.
2. **Quality Filtering & Trimming**: Uses `fastp` for adapter trimming and read quality filtering.
3. **Host Depletion**: Removes human host reads utilizing `hostile` (Bowtie2 alignment against the `human-t2t-hla-argos985` index).
4. **Clean Read QC**: Re-evaluates quality post-trimming using FastQC and MultiQC.
5. **AMR Gene Alignment**: Aligns host-depleted microbial reads to the ResFinder database using Bowtie2. Uses highly sensitive alignment parameters (`-D 20 -R 3 -N 1 -L 20 -i S,1,0.5`) to detect mutated or novel resistance genes.
6. **Alignment Filtering**: Filters BAM files via `samtools` and `awk` to keep discordant pairs or only Read 1 of concordant pairs (to prevent double-counting).
7. **Read Counting**: Extracts read counts per AMR gene using `samtools idxstats`.
8. **Count Merging**: Aggregates individual sample counts into a single master TSV matrix using the provided Python script (`mergeGeneCounts.py`).

## Requirements

* Nextflow (DSL2)
* Python 3.x with `pandas` (for `mergeGeneCounts.py`)
* Dependencies (handled via modules or containers in the scripts):
* FastQC
* fastp
* MultiQC
* Hostile
* Bowtie2
* Samtools (v1.9)



## Inputs and Parameters

The pipeline requires specific parameters to be set in the `countARGs.nf` workflow or via a configuration file/command-line arguments:

* `params.reads_dir`: Directory containing the input FASTQ files (`*_R1.fastq.gz` and `*_R2.fastq.gz`).
* `params.samplesheet`: A CSV file with a `sample_id` column dictating the samples to process.
* `params.outdir`: The base output directory for pipeline results.
* `params.resfinder_db`: Path to the indexed ResFinder database prefix.
* `hostile_idx_ch`: Channel pointing to the directory containing the Hostile index.

## Scripts

### `workflow/countARGs.nf`

The main Nextflow execution script. It orchestrates the directed acyclic graph (DAG) of processes, loading sub-processes from the `modules` directory.

### `modules/preProc.nf`

Contains the definitions for the read preprocessing Nextflow processes: `FASTQC_RAW`, `FASTP_DECONTAMINATE`, `FASTQC_CLEAN`, `MULTIQC`, and `REMOVE_HOST_HOSTILE`.

### `mergeGeneCounts.py`

A standalone Python utility designed to merge individual `*_ARG_counts` files generated by the Nextflow pipeline into a single `Matrix.tsv`.
**Usage:**

```bash
python mergeGeneCounts.py <input_files...> <output_file>

```
